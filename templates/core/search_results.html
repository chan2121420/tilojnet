{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- ============================================
     HERO
     ============================================ -->
<section style="min-height: 50vh; display: flex; align-items: center; margin-top: 76px; background: var(--off-white);">
    <div class="container-narrow" style="text-align: center;">
        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: var(--space-sm);">Search Results</div>
        <h1 class="fade-in-up" style="margin-bottom: var(--space-md);">"{{ query }}"</h1>
        <p class="lead fade-in-up delay-1">
            Found {{ total_results }} result{{ total_results|pluralize }}
        </p>
    </div>
</section>

<!-- ============================================
     SEARCH BAR
     ============================================ -->
<section style="background: var(--pure-white); padding: var(--space-md) 0; border-bottom: 1px solid var(--light-grey);">
    <div class="container">
        <form method="get" action="{% url 'search_categories' %}">
            <div style="display: flex; gap: var(--space-sm);">
                <input type="text" name="q" value="{{ query }}" placeholder="Search categories and items..." required style="flex: 1; padding: 1rem; border: 1px solid var(--light-grey); font-family: var(--font-body); font-size: 1rem;">
                <button type="submit" class="btn-primary">Search</button>
            </div>
        </form>
    </div>
</section>

<!-- ============================================
     RESULTS
     ============================================ -->
<section class="section">
    <div class="container">
        {% if categories or items %}
            
            <!-- Categories -->
            {% if categories %}
            <div style="margin-bottom: var(--space-2xl);">
                <h2 style="margin-bottom: var(--space-lg);">Services ({{ categories.count }})</h2>
                
                <div style="display: grid; gap: var(--space-xl);">
                    {% for category in categories %}
                    <a href="{% url 'category_detail' category.slug %}" style="display: grid; grid-template-columns: 350px 1fr; gap: var(--space-lg); align-items: center; text-decoration: none; color: inherit; padding-bottom: var(--space-lg); border-bottom: 1px solid var(--light-grey);">
                        <div style="overflow: hidden;">
                            <img src="{{ category.featured_image.url }}" alt="{{ category.name }}" style="width: 100%; height: 250px; object-fit: cover; transition: var(--transition-smooth);">
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: var(--space-sm);">{{ category.item_count }} Design Option{{ category.item_count|pluralize }}</div>
                            <h3 style="font-size: 2rem; margin-bottom: var(--space-sm);">{{ category.name }}</h3>
                            <p style="margin-bottom: var(--space-md);">{{ category.description|truncatewords:25 }}</p>
                            <span class="btn-text">Explore {{ category.name }}</span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Items -->
            {% if items %}
            <div>
                <h2 style="margin-bottom: var(--space-lg);">Design Options ({{ items.count }})</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: var(--space-lg);">
                    {% for item in items %}
                    <a href="{% url 'category_item_detail' item.category.slug item.slug %}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="margin-bottom: var(--space-md); overflow: hidden; position: relative;">
                            <img src="{{ item.featured_image.url }}" alt="{{ item.name }}" style="width: 100%; height: 350px; object-fit: cover; transition: var(--transition-smooth);">
                            {% if item.is_popular or item.is_new %}
                            <div style="position: absolute; top: var(--space-sm); right: var(--space-sm);">
                                {% if item.is_new %}
                                <span style="background: var(--charcoal); color: var(--pure-white); padding: 0.5rem 1rem; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase; display: block; margin-bottom: 0.5rem;">New</span>
                                {% endif %}
                                {% if item.is_popular %}
                                <span style="background: var(--gold-accent); color: var(--charcoal); padding: 0.5rem 1rem; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase; display: block;">Popular</span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        <div style="font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">{{ item.category.name }}</div>
                        <h4 style="font-size: 1.25rem; margin-bottom: var(--space-sm);">{{ item.name }}</h4>
                        <p style="font-size: 0.875rem; color: var(--warm-grey);">{{ item.short_description|truncatewords:15 }}</p>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
        {% else %}
            <!-- No Results -->
            <div style="text-align: center; padding: var(--space-2xl) 0;">
                <h3 style="margin-bottom: var(--space-md);">No Results Found</h3>
                <p class="lead" style="margin-bottom: var(--space-lg);">
                    We couldn't find anything matching "{{ query }}". Try different keywords or browse our services.
                </p>
                <a href="{% url 'categories_list' %}" class="btn-primary">Browse Services</a>
            </div>
        {% endif %}
    </div>
</section>

<style>
/* Hover effects */
section a[href*="category_detail"]:hover img,
section a[href*="category_item_detail"]:hover img {
    transform: scale(1.05);
}

@media (max-width: 768px) {
    section a[href*="category_detail"] {
        grid-template-columns: 1fr !important;
    }
    
    section div[style*="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))"] {
        grid-template-columns: 1fr !important;
    }
}
</style>

{% endblock %}