{% extends 'base.html' %}
{% load static %}

{% block content %}

<section style="margin-top: 100px; padding: var(--space-md) 0; background: var(--off-white);">
    <div class="container">
        <nav style="font-size: 0.875rem; color: var(--warm-grey);">
            <a href="{% url 'home' %}" style="color: var(--warm-grey); text-decoration: none;">Home</a>
            <span style="margin: 0 0.5rem;">/</span>
            <a href="{% url 'categories_list' %}" style="color: var(--warm-grey); text-decoration: none;">Services</a>
            <span style="margin: 0 0.5rem;">/</span>
            <a href="{% url 'category_detail' category.slug %}" style="color: var(--warm-grey); text-decoration: none;">{{ category.name }}</a>
            <span style="margin: 0 0.5rem;">/</span>
            <span style="color: var(--charcoal);">{{ item.name }}</span>
        </nav>
    </div>
</section>

<section class="section">
    <div class="container">
        <div style="display: grid; grid-template-columns: 1.2fr 1fr; gap: var(--space-xl); align-items: start;">
            <!-- Image Gallery -->
            <div>
                <div style="margin-bottom: var(--space-md); overflow: hidden;">
                    <img id="mainImage" src="{{ item.featured_image.url }}" alt="{{ item.name }}" style="width: 100%; height: 600px; object-fit: cover;">
                </div>
                
                {% if item.gallery.all %}
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: var(--space-sm);">
                    <!-- Featured Image Thumbnail -->
                    <div onclick="changeImage('{{ item.featured_image.url }}', this)" style="cursor: pointer; overflow: hidden; border: 2px solid var(--light-grey); transition: var(--transition-fast);">
                        <img src="{{ item.featured_image.url }}" alt="{{ item.name }}" style="width: 100%; height: 120px; object-fit: cover;">
                    </div>
                    
                    <!-- Gallery Images -->
                    {% for img in item.gallery.all %}
                    <div onclick="changeImage('{{ img.image.url }}', this)" style="cursor: pointer; overflow: hidden; border: 2px solid var(--light-grey); transition: var(--transition-fast);">
                        <img src="{{ img.image.url }}" alt="{{ img.caption|default:item.name }}" style="width: 100%; height: 120px; object-fit: cover;">
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <!-- Details Sidebar -->
            <div style="position: sticky; top: 120px;">
                <div style="margin-bottom: var(--space-md);">
                    <a href="{% url 'category_detail' category.slug %}" style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); text-decoration: none;">{{ category.name }}</a>
                </div>
                
                {% if item.is_popular or item.is_new %}
                <div style="margin-bottom: var(--space-sm); display: flex; gap: 0.5rem;">
                    {% if item.is_new %}
                    <span style="background: var(--charcoal); color: var(--pure-white); padding: 0.5rem 1rem; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;">New</span>
                    {% endif %}
                    {% if item.is_popular %}
                    <span style="background: var(--gold-accent); color: var(--charcoal); padding: 0.5rem 1rem; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;">Popular</span>
                    {% endif %}
                </div>
                {% endif %}
                
                <h1 style="font-size: 2.5rem; margin-bottom: var(--space-md);">{{ item.name }}</h1>
                
                <p style="margin-bottom: var(--space-lg); line-height: 1.8;">{{ item.short_description }}</p>
                
                <!-- Specifications -->
                <div style="border-top: 1px solid var(--light-grey); padding-top: var(--space-md); margin-bottom: var(--space-md);">
                    {% if item.price_range %}
                    <div style="margin-bottom: var(--space-md);">
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">Price Range</div>
                        <div style="font-family: var(--font-display); font-size: 1.5rem; color: var(--charcoal);">{{ item.price_range }}</div>
                    </div>
                    {% endif %}
                    
                    {% if item.duration %}
                    <div style="margin-bottom: var(--space-md);">
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">Duration</div>
                        <div>{{ item.duration }}</div>
                    </div>
                    {% endif %}
                    
                    {% if item.ideal_space_size %}
                    <div style="margin-bottom: var(--space-md);">
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">Ideal Space</div>
                        <div>{{ item.ideal_space_size }}</div>
                    </div>
                    {% endif %}
                </div>
                
                {% if item.design_styles %}
                <div style="border-top: 1px solid var(--light-grey); padding-top: var(--space-md); margin-bottom: var(--space-md);">
                    <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: var(--space-sm);">Design Styles</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        {% for style in item.design_styles %}
                        <span style="padding: 0.5rem 1rem; border: 1px solid var(--light-grey); font-size: 0.875rem;">{{ style }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                {% if item.key_features %}
                <div style="border-top: 1px solid var(--light-grey); padding-top: var(--space-md); margin-bottom: var(--space-lg);">
                    <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: var(--space-sm);">Key Features</div>
                    <ul style="list-style: none; padding: 0;">
                        {% for feature in item.key_features %}
                        <li style="margin-bottom: 0.5rem; padding-left: 1.5rem; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--gold-accent);">â€¢</span>
                            {{ feature }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                <a href="{% url 'quote_request' %}" class="btn-primary" style="width: 100%; text-align: center; margin-bottom: var(--space-sm);">Request Consultation</a>
                <a href="{% url 'contact' %}" class="btn-secondary" style="width: 100%; text-align: center;">Contact Us</a>
            </div>
        </div>
    </div>
</section>

{% if item.full_description %}
<section style="background: var(--off-white); padding: var(--space-2xl) 0;">
    <div class="container-narrow">
        <h2 style="margin-bottom: var(--space-lg);">Details</h2>
        <div style="line-height: 1.8;">
            {{ item.full_description|safe }}
        </div>
    </div>
</section>
{% endif %}

{% if related_items %}
<section class="section">
    <div class="container">
        <h2 style="margin-bottom: var(--space-lg);">Similar Designs</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-lg);">
            {% for rel_item in related_items|slice:":3" %}
            <a href="{% url 'category_item_detail' category.slug rel_item.slug %}" style="text-decoration: none; color: inherit; display: block;">
                <div style="margin-bottom: var(--space-md); overflow: hidden;">
                    <img src="{{ rel_item.featured_image.url }}" alt="{{ rel_item.name }}" style="width: 100%; height: 300px; object-fit: cover; transition: var(--transition-smooth);">
                </div>
                <h4 style="font-size: 1.25rem; margin-bottom: var(--space-sm);">{{ rel_item.name }}</h4>
                <p style="font-size: 0.875rem; color: var(--warm-grey);">{{ rel_item.short_description|truncatewords:15 }}</p>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<script>
function changeImage(imageUrl, thumbElement) {
    const mainImage = document.getElementById('mainImage');
    if (mainImage) {
        mainImage.src = imageUrl;
        
        // Update active thumbnail
        document.querySelectorAll('[onclick*="changeImage"]').forEach(thumb => {
            thumb.style.borderColor = 'var(--light-grey)';
        });
        if (thumbElement) {
            thumbElement.style.borderColor = 'var(--charcoal)';
        }
    }
}
</script>

<style>
/* Related items hover */
section a[href*="category_item_detail"]:hover img {
    transform: scale(1.05);
}

/* Thumbnail hover */
div[onclick*="changeImage"]:hover {
    border-color: var(--charcoal) !important;
}

@media (max-width: 768px) {
    section div[style*="grid-template-columns: 1.2fr 1fr"] {
        grid-template-columns: 1fr !important;
    }
    
    div[style*="position: sticky"] {
        position: static !important;
    }
}
</style>

{% endblock %}