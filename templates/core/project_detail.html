{% extends 'base.html' %}
{% load static %}

{% block content %}

<section style="margin-top: 100px; padding: var(--space-md) 0; background: var(--off-white);">
    <div class="container">
        <nav style="font-size: 0.875rem; color: var(--warm-grey);">
            <a href="{% url 'home' %}" style="color: var(--warm-grey); text-decoration: none;">Home</a>
            <span style="margin: 0 0.5rem;">/</span>
            <a href="{% url 'projects_list' %}" style="color: var(--warm-grey); text-decoration: none;">Portfolio</a>
            <span style="margin: 0 0.5rem;">/</span>
            <span style="color: var(--charcoal);">{{ project.title }}</span>
        </nav>
    </div>
</section>

<section class="section">
    <div class="container">
        <div style="max-width: 800px; margin-bottom: var(--space-lg);">
            {% if project.is_featured %}
            <div style="margin-bottom: var(--space-sm);">
                <span style="background: var(--gold-accent); color: var(--charcoal); padding: 0.5rem 1rem; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;">Featured Project</span>
            </div>
            {% endif %}
            
            <div style="margin-bottom: var(--space-sm);">
                {% if project.category %}
                <span style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey);">{{ project.category.name }}</span>
                {% endif %}
            </div>
            
            <h1 style="margin-bottom: var(--space-md);">{{ project.title }}</h1>
            
            <div style="display: flex; gap: var(--space-md); flex-wrap: wrap; font-size: 0.875rem; color: var(--warm-grey); margin-bottom: var(--space-md);">
                <div>{{ project.location }}</div>
                <div>{{ project.project_date|date:"Y" }}</div>
                {% if project.duration %}
                <div>{{ project.duration }}</div>
                {% endif %}
            </div>
            
            <p class="lead">{{ project.short_description }}</p>
        </div>
        
        <!-- Main Image -->
        <div style="margin-bottom: var(--space-md); overflow: hidden;">
            <img id="mainImage" src="{{ project.featured_image.url }}" alt="{{ project.title }}" style="width: 100%; height: 700px; object-fit: cover;">
        </div>
        
        <!-- Gallery Thumbnails -->
        {% if project.images.all %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: var(--space-sm); margin-bottom: var(--space-xl);">
            <!-- Featured Image -->
            <div onclick="changeImage('{{ project.featured_image.url }}', this)" style="cursor: pointer; overflow: hidden; border: 2px solid var(--charcoal); transition: var(--transition-fast);">
                <img src="{{ project.featured_image.url }}" alt="{{ project.title }}" style="width: 100%; height: 150px; object-fit: cover;">
            </div>
            
            {% for img in project.images.all %}
            <div onclick="changeImage('{{ img.image.url }}', this)" style="cursor: pointer; overflow: hidden; border: 2px solid var(--light-grey); transition: var(--transition-fast);">
                <img src="{{ img.image.url }}" alt="{{ img.caption|default:project.title }}" style="width: 100%; height: 150px; object-fit: cover;">
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</section>

<section style="background: var(--off-white); padding: var(--space-2xl) 0;">
    <div class="container">
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-xl);">
            <!-- Main Content -->
            <div>
                <h2 style="margin-bottom: var(--space-lg);">Project Overview</h2>
                <div style="line-height: 1.8; margin-bottom: var(--space-xl);">
                    {{ project.full_description|safe }}
                </div>
                
                {% if project.challenge %}
                <div style="margin-bottom: var(--space-xl);">
                    <h3 style="margin-bottom: var(--space-md);">Challenge</h3>
                    <div style="line-height: 1.8;">{{ project.challenge|safe }}</div>
                </div>
                {% endif %}
                
                {% if project.solution %}
                <div style="margin-bottom: var(--space-xl);">
                    <h3 style="margin-bottom: var(--space-md);">Solution</h3>
                    <div style="line-height: 1.8;">{{ project.solution|safe }}</div>
                </div>
                {% endif %}
                
                {% if project.result %}
                <div>
                    <h3 style="margin-bottom: var(--space-md);">Result</h3>
                    <div style="line-height: 1.8;">{{ project.result|safe }}</div>
                </div>
                {% endif %}
            </div>
            
            <!-- Sidebar -->
            <div>
                <div style="background: var(--pure-white); padding: var(--space-lg); margin-bottom: var(--space-md);">
                    <h4 style="margin-bottom: var(--space-md);">Project Details</h4>
                    
                    {% if project.client_name %}
                    <div style="margin-bottom: var(--space-md); padding-bottom: var(--space-md); border-bottom: 1px solid var(--light-grey);">
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">Client</div>
                        <div>{{ project.client_name }}</div>
                    </div>
                    {% endif %}
                    
                    <div style="margin-bottom: var(--space-md); padding-bottom: var(--space-md); border-bottom: 1px solid var(--light-grey);">
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">Completed</div>
                        <div>{{ project.project_date|date:"F Y" }}</div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-md); padding-bottom: var(--space-md); border-bottom: 1px solid var(--light-grey);">
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">Location</div>
                        <div>{{ project.location }}</div>
                    </div>
                    
                    {% if project.service_categories.all %}
                    <div style="margin-bottom: var(--space-md); padding-bottom: var(--space-md); border-bottom: 1px solid var(--light-grey);">
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: var(--space-sm);">Services</div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            {% for sc in project.service_categories.all %}
                            <a href="{% url 'category_detail' sc.slug %}" style="color: var(--charcoal); text-decoration: none; font-size: 0.875rem;">{{ sc.name }}</a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if project.duration %}
                    <div style="margin-bottom: var(--space-md); padding-bottom: var(--space-md); border-bottom: 1px solid var(--light-grey);">
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">Duration</div>
                        <div>{{ project.duration }}</div>
                    </div>
                    {% endif %}
                    
                    {% if project.area_sqm %}
                    <div>
                        <div style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--warm-grey); margin-bottom: 0.5rem;">Area</div>
                        <div>{{ project.area_sqm }} mÂ²</div>
                    </div>
                    {% endif %}
                </div>
                
                <div style="background: var(--charcoal); color: var(--pure-white); padding: var(--space-lg); text-align: center;">
                    <h4 style="color: var(--pure-white); margin-bottom: var(--space-md);">Interested?</h4>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.8); margin-bottom: var(--space-md);">
                        We can create something similar for your space.
                    </p>
                    <a href="{% url 'quote_request' %}" class="btn-primary" style="width: 100%; background: var(--pure-white); color: var(--charcoal);">Request Consultation</a>
                </div>
            </div>
        </div>
    </div>
</section>

{% if related_projects %}
<section class="section">
    <div class="container">
        <h2 style="margin-bottom: var(--space-lg);">Related Projects</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: var(--space-lg);">
            {% for rp in related_projects|slice:":3" %}
            <a href="{% url 'project_detail' rp.slug %}" style="display: block; text-decoration: none; color: inherit; position: relative; overflow: hidden; height: 400px;">
                <img src="{{ rp.featured_image.url }}" alt="{{ rp.title }}" style="width: 100%; height: 100%; object-fit: cover; transition: var(--transition-smooth);">
                <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: var(--space-md); background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); color: var(--pure-white);">
                    {% if rp.category %}
                    <div style="font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 0.5rem; color: var(--gold-accent);">{{ rp.category.name }}</div>
                    {% endif %}
                    <h4 style="color: var(--pure-white); margin-bottom: 0.5rem;">{{ rp.title }}</h4>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.8);">{{ rp.location }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<section style="background: var(--off-white); padding: var(--space-2xl) 0;">
    <div class="container-narrow" style="text-align: center;">
        <h2 style="margin-bottom: var(--space-md);">Ready to Start Your Project?</h2>
        <p class="lead" style="margin-bottom: var(--space-lg);">
            Let's discuss how we can bring your vision to life.
        </p>
        <div style="display: flex; gap: var(--space-md); justify-content: center; flex-wrap: wrap;">
            <a href="{% url 'quote_request' %}" class="btn-primary">Request Consultation</a>
            <a href="{% url 'projects_list' %}" class="btn-secondary">View More Projects</a>
        </div>
    </div>
</section>

<script>
function changeImage(imageUrl, thumbElement) {
    const mainImage = document.getElementById('mainImage');
    if (mainImage) {
        mainImage.src = imageUrl;
        
        // Update active thumbnail
        document.querySelectorAll('[onclick*="changeImage"]').forEach(thumb => {
            thumb.style.borderColor = 'var(--light-grey)';
        });
        if (thumbElement) {
            thumbElement.style.borderColor = 'var(--charcoal)';
        }
    }
}
</script>

<style>
/* Project hover */
section a[href*="project_detail"]:hover img {
    transform: scale(1.1);
}

/* Thumbnail hover */
div[onclick*="changeImage"]:hover {
    border-color: var(--charcoal) !important;
}

@media (max-width: 768px) {
    section div[style*="grid-template-columns: 2fr 1fr"] {
        grid-template-columns: 1fr !important;
    }
}
</style>

{% endblock %}